#### 指针不可乱用

安全地使用指针, 需要有对指针足够清楚的认识.



在使用指针之前, 一定要弄清楚两个问题:

1. 这个指针指向了哪儿?
2. 这个指针指向的那个地方是否有效? (是否能够访问)



#### 指针指向了哪儿?

就目前来说, 指针只允许指向两个地方:

1. 指向了变量/数组
2. 指向0



第一种情况:

```c++
int n;
int* p1 = &n; // p1指向的内存: 一个变量
int arr[4];
int* p2 = arr; // p2指向的内存:一个数组
```



第二种情况:

```c++
int* p = 0; // 空指针
```



也就是说, 这个指针要么指向了一个变量/数组, 要么指向0, 不允许有第三种情况.

```c++
int* p; // 这个指针指向哪了? 一个莫名其妙的地方
printf("%d\n", *p); // 立即崩溃
```

当一个指针未赋值时, 其值为随机值, 此时指向了一个随机的内存地址. 称为"野指针" wild pointer



##### 空指针

值为0的指针, 称为空指针.

```c++
int* p = 0;
```

当指针为空的时候, 不能使用*操作.

```c++
int* p = NULL; // 这个指针指向哪了? 一个莫名其妙的地方
printf("%d\n", *p); // 立即崩溃
```

但空指针是程序员可以接受的一种情况, 只需要加上一个if判断就能解决!

```c
int* p = 0;
if(p)
{
 	printf("%d\n", *p);   
}
```

###### 空指针应用

某些参数可以省, 当不想传入时就传入一个空指针

```c
void min_max(const int* arr, int len, int* pmax, int* pmin)
{
    int _max = 0;
    int _min = 0;
    // ......
    if(pmax)
    {
        *pmax = _max;
    }
    
    if(pmin)
    {
        *pmin = _min;
    }
}

int main()
{
    int arr[] = {1,2,3,4};
    min_max(arr, 4, &arr[0],0); // 表示只需要得到最大值
    return 0;
}
```



## 安全使用指针：（1）杜绝野指针

一个好习惯： 初始化为空指针。。。

int * p = 0;



考虑：为什么传递一个空指针是允许的？ 而传一个野指针是不允许的？

（空指针也会崩溃）

```c
int * p = 0;
printf("%d\n", *p);
```



因为

传递空指针： 函数内部是有办法处理的， 判断一下就行。

传递野指针： 函数内部无法判断出来你是个野指针



## 安全使用指针：（2）严防数组越界

当指针指向数组时， 要注意不要越界访问

```c
int arr[4];
int * p = arr;

p += 4;
*p = 12;
```

## 安全使用指针： (3) 变量是否已经失效？
如果指向的目标的生命期已经终结（失效）， 则该指针也失效。
```c
int main()
{
	int * p = 0；
	
	if(1)
    {
        int a = 10; // a 生效
        p = &a;
    }
    *p = 11;  //  p 指向了一个无效的位置
    return 0;
}
```
在vc中不一定能发生运行错误， 但不代表可以这样做。
（在引入类的概念之后， 可以很容易说明这个问题的严重性）

所以， 指向全局变量的指针， 安全性相对较高。因为它的生命期是永恒的，这一块内存总是有效的。

# 小结
1. 野指针的概念
2. 空指针的概念及应用
3. 安全使用指针的注意事项
